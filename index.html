<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Rugby Command Center</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --bg-dark: #1e2a38;
            --header-bg: #1a252f;
            --accent-yellow: #f1c40f;
            --btn-green: #2ecc71;
            --btn-blue: #3498db;
            --btn-red: #e74c3c;
            --btn-orange: #e67e22;
            --btn-gray: #95a5a6;
            --circle-green: #2ecc71;
            --circle-blue: #3498db;
            --circle-red: #ff0000;
            --selected-orange: #f39c12;
            --tactical-blue: #2980b9;
            --injured-gray: #bdc3c7;
            --light-red: #ffcdd2;
            --fr-highlight: #e3f2fd;
            --treating-red: #ff0000;
        }

        body {
            margin: 0; font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
            background-color: var(--bg-dark); color: #ffffff;
            overflow: hidden; display: flex; flex-direction: column; height: 100vh;
        }

        header {
            background-color: var(--header-bg); padding: 8px 15px;
            display: flex; align-items: center; justify-content: space-between;
            border-bottom: 2px solid #333; height: 65px; box-sizing: border-box;
            position: relative;
        }

        #uncontested-banner {
            display: none;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background-color: #ff0000;
            color: white;
            text-align: center;
            font-weight: bold;
            padding: 5px 15px;
            font-size: 14px;
            border-radius: 4px;
            white-space: nowrap;
            z-index: 10;
        }

        .header-left { display: flex; align-items: center; gap: 20px; }
        #team-name-display { font-size: 22px; font-weight: 900; color: var(--accent-yellow); border-left: 5px solid var(--accent-yellow); padding-left: 15px; }
        #category-display { font-size: 18px; font-weight: bold; color: white; background: rgba(255,255,255,0.1); padding: 4px 12px; border-radius: 4px; }

        .timer-container { position: relative; display: flex; align-items: center; gap: 10px; background: #000; padding: 5px 15px; border-radius: 10px; border: 2px solid #444; }
        #timer-display { font-family: 'Courier New', Courier, monospace; font-size: 42px; color: #00ff00; font-weight: bold; min-width: 130px; text-align: center; cursor: pointer; user-select: none; }
        #start-btn { min-width: 80px; font-weight: 900; border-radius: 5px; border: none; padding: 10px; cursor: pointer; }
        .btn-start-style { background-color: var(--btn-green); color: white; }
        .btn-stop-style { background-color: var(--btn-red); color: white; }

        #timer-edit-popup { display: none; position: absolute; top: 60px; left: 0; background: #333; border: 2px solid var(--accent-yellow); padding: 10px; border-radius: 8px; z-index: 4000; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .edit-row { display: flex; align-items: center; justify-content: center; gap: 15px; }
        .edit-unit { display: flex; flex-direction: column; align-items: center; }
        .spin-btn { background: #555; color: white; border: none; width: 50px; height: 40px; font-size: 24px; cursor: pointer; border-radius: 4px; }
        .spin-btn:hover { background: #777; }
        .edit-val { font-size: 32px; font-weight: bold; margin: 5px 0; color: var(--accent-yellow); font-family: monospace; }

        main { 
            display: grid; 
            grid-template-columns: 310px 310px 310px 1fr; 
            gap: 10px; padding: 10px; flex-grow: 1; height: calc(100vh - 65px); box-sizing: border-box; 
        }

        .column { display: flex; flex-direction: column; gap: 10px; height: 100%; overflow: hidden; }

        .panel-header { padding: 6px; text-align: center; font-weight: bold; font-size: 13px; color: white; height: 30px; box-sizing: border-box; }
        .panel-header.green { background-color: var(--btn-green); }
        .panel-header.blue { background-color: var(--btn-blue); }
        .panel-header.yellow { background-color: var(--accent-yellow); color: black; }

        .list-container { background: white; color: black; border: 1px solid #ccc; overflow: hidden; box-sizing: border-box; transition: background-color 0.2s; }
        .list-container.drag-over { background-color: #e3f2fd; border: 2px dashed var(--btn-blue); }
        
        #field-list { height: 550px; }
        #bench-list { height: 295px; }
        #reservation-list, #management-list, #main-log, #penalty-log, #ejected-list { overflow-y: auto; }

        #setting-area { padding: 8px; display: flex; flex-direction: column; gap: 8px; }
        .setting-row { display: flex; gap: 5px; width: 100%; align-items: center; }
        .setting-btn { flex: 1; padding: 8px 2px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; color: white; font-size: 11px; text-align: center; }
        
        .half-end-box { flex: 1.5; display: flex; align-items: center; background: #eee; border-radius: 4px; padding-right: 5px; }
        #half-end-time-display { font-weight: bold; font-size: 14px; color: var(--btn-red); margin-left: auto; }

        .player-row { display: grid; grid-template-columns: 28px 42px 135px 30px 45px 35px; align-items: center; height: 34.5px; border-bottom: 1px solid #eee; padding: 0 2px 0 5px; font-size: 13px; cursor: pointer; background-color: white; position: relative; }
        .player-row.selected { background-color: var(--selected-orange) !important; color: white !important; }
        .player-row.selected * { color: white !important; }
        .player-row.fr-match { background-color: var(--fr-highlight); }
        
        /* 一時退出中(出血/HIA等)は黒文字に戻す（指示通り） */
        .player-row.status-treating { color: #000000 !important; }
        .player-row.status-treating .player-name { color: #000000 !important; }
        
        .player-row.status-tactical-out { color: var(--tactical-blue) !important; }
        .player-row.status-tactical-out .player-name { color: var(--tactical-blue) !important; }
        .player-row.status-injured-out { background-color: var(--injured-gray) !important; color: #7f8c8d !important; cursor: not-allowed; }
        .player-row.status-injured-out * { color: #7f8c8d !important; }
        
        .player-row.empty-row { color: #888; } 

        .pos-circle { width: 20px; height: 20px; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; }
        .field-circle { background-color: var(--circle-green); }
        .bench-circle { background-color: var(--circle-blue); }
        .red-circle { background-color: var(--circle-red); }
        .player-name { font-weight: 900; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .fr-cond { color: var(--btn-orange); font-weight: bold; font-size: 11px; text-align: right; }

        .btn-ejected-del { background: var(--btn-gray); color: white; border: none; padding: 2px 4px; border-radius: 3px; font-size: 9px; cursor: pointer; font-weight: bold; }

        .log-entry { font-size: 12px; padding: 8px; border-bottom: 1px solid #ddd; position: relative; color: black; }
        .log-entry.yc-bg { background-color: #fff176; }
        .log-entry.rc-bg { background-color: #ffcdd2; }
        .btn-log-del { position: absolute; top: 5px; right: 5px; background: var(--btn-gray); color: white; border: none; padding: 2px 6px; border-radius: 3px; font-size: 10px; cursor: pointer; }

        .reserve-card { margin: 5px; padding: 8px; border: 2px solid var(--btn-green); border-radius: 8px; background: white; position: relative; display: flex; align-items: center; font-size: 12px; gap: 5px; }
        .reserve-info { flex-grow: 1; overflow: hidden; }
        .reserve-remaining { position: absolute; top: 5px; right: 8px; color: var(--btn-red); font-weight: bold; font-size: 12px; font-family: monospace; }
        .reserve-btns { display: flex; gap: 3px; flex-shrink: 0; margin-top: 15px; }
        .btn-reserve-exe { background: var(--btn-green); color: white; border: none; width: 45px; height: 35px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 11px; }
        .btn-reserve-del { background: var(--btn-gray); color: white; border: none; width: 45px; height: 35px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 11px; }

        .mgt-card { margin: 5px; padding: 10px; border: 2px solid var(--btn-orange); border-radius: 10px; background: white; }
        .mgt-header { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 8px; font-size: 11px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .mgt-type { color: var(--btn-orange); }
        .mgt-timer { font-size: 24px; color: var(--btn-red); font-family: monospace; font-weight: bold; }
        .mgt-player-info { font-size: 13px; margin: 8px 0; line-height: 1.4; }
        .mgt-reason-input { width: 100%; padding: 5px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 12px; }
        .mgt-btns-row { display: flex; flex-direction: column; gap: 8px; }
        .mgt-status-btns { display: flex; gap: 4px; justify-content: flex-start; flex-wrap: wrap; align-items: center; }
        .mgt-status-btns button { font-size: 11px; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; background: #f8f8f8; font-weight: bold; flex: 1; min-width: 60px; }
        
        .mgt-status-btns button.active-yellow { background: var(--accent-yellow) !important; color: black !important; border-color: var(--accent-yellow) !important; }
        .mgt-status-btns button.active-red { background: var(--light-red) !important; color: #c0392b !important; border-color: var(--btn-red) !important; }
        .mgt-status-btns button.active-normal { background: var(--btn-orange) !important; color: white !important; border-color: var(--btn-orange) !important; }
        .btn-decision-exe { background: var(--btn-green) !important; color: white !important; border-color: var(--btn-green) !important; }

        .mgt-action-btns { display: flex; gap: 4px; justify-content: flex-end; }
        .btn-mgt-exe { background: var(--btn-green); color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 11px; }
        .btn-mgt-del { background: var(--btn-gray); color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 11px; }

        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 3000; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 15px; border-radius: 12px; width: 310px; color: black; max-height: 90vh; overflow-y: auto; }
        .modal-title { font-weight: bold; margin-bottom: 10px; border-bottom: 2px solid var(--btn-blue); padding-bottom: 5px; font-size: 14px; }

        #floating-menu { display: none; position: fixed; top: 120px; left: 50%; transform: translateX(-50%); width: 280px; background: var(--bg-dark); border-radius: 12px; border: 2px solid #444; z-index: 2000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        #menu-drag-handle { padding: 10px; background: #1a252f; cursor: move; text-align: center; color: var(--accent-yellow); font-weight: bold; border-radius: 10px 10px 0 0; }
        .menu-grid { padding: 12px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .menu-grid button { padding: 10px 5px; border: none; border-radius: 6px; color: white; font-weight: bold; cursor: pointer; font-size: 12px; }
        #open-menu-btn { position: fixed; bottom: 20px; right: 20px; padding: 15px 35px; background: var(--accent-yellow); color: black; font-weight: 900; border-radius: 40px; border: none; cursor: pointer; z-index: 1000; }
    </style>
</head>
<body onload="init()">

<header>
    <div class="header-left">
        <div id="team-name-display">TEAM NAME</div>
        <div id="category-display">Category: 0/0</div>
    </div>
    <div id="uncontested-banner">アンコンテスト・スクラム</div>
    <div class="header-right" style="display:flex; align-items:center; gap:15px;">
        <div class="timer-container">
            <div id="timer-display" ondblclick="toggleTimerEdit()">00:00</div>
            <button onclick="toggleTimer()" id="start-btn" class="btn-start-style">START</button>
            <div id="timer-edit-popup">
                <div class="edit-row">
                    <div class="edit-unit">
                        <button class="spin-btn" onclick="adjustTime(60)">▲</button>
                        <div class="edit-val" id="edit-min">00</div>
                        <button class="spin-btn" onclick="adjustTime(-60)">▼</button>
                    </div>
                    <div style="font-size:32px; font-weight:bold; padding-top:40px;">:</div>
                    <div class="edit-unit">
                        <button class="spin-btn" onclick="adjustTime(1)">▲</button>
                        <div class="edit-val" id="edit-sec">00</div>
                        <button class="spin-btn" onclick="adjustTime(-1)">▼</button>
                    </div>
                </div>
                <button onclick="toggleTimerEdit()" style="width:100%; margin-top:10px; padding:5px; background:var(--btn-gray); color:white; border:none; border-radius:4px; font-weight:bold; cursor:pointer;">閉じる</button>
            </div>
        </div>
        <button onclick="resetTimer()" style="background:var(--btn-gray); color:white; border:none; padding:8px 12px; border-radius:5px; cursor:pointer; font-weight:bold;">RESET</button>
    </div>
</header>

<main>
    <div class="column">
        <div class="panel-header green">FIELD (1-15)</div>
        <div class="list-container" id="field-list"></div>
        <div class="panel-header yellow">SETTING</div>
        <div class="list-container" id="setting-area" style="flex-grow:1;">
            <div class="setting-row">
                <input type="file" id="excel-input" style="display:none" onchange="handleExcel(event)">
                <button class="setting-btn" onclick="document.getElementById('excel-input').click()" style="background:var(--btn-blue);">LOAD EXCEL</button>
                <button class="setting-btn" onclick="openCatModal()" style="background:var(--btn-blue);">CATEGORY</button>
            </div>
            <div class="setting-row">
                <button class="setting-btn" onclick="openRestoreModal()" style="background:var(--btn-red);">選手復帰</button>
                <div class="half-end-box">
                    <button class="setting-btn" onclick="recordHalfEnd()" style="background:var(--btn-orange); flex:none; width:65px;">前半終了</button>
                    <div id="half-end-time-display">--:--</div>
                </div>
            </div>
        </div>
    </div>
    <div class="column">
        <div class="panel-header blue">BENCH (16-23)</div>
        <div class="list-container" id="bench-list"></div>
        <div class="panel-header yellow">退場</div>
        <div class="list-container" id="ejected-list" style="height: 140px;"></div>
        <div class="panel-header yellow">PENALTY LOG</div>
        <div class="list-container" id="penalty-log" style="flex-grow: 1;"></div>
    </div>
    <div class="column">
        <div class="panel-header yellow">予約リスト</div>
        <div class="list-container" id="reservation-list" style="height: 50%;"></div>
        <div class="panel-header yellow">管理エリア</div>
        <div class="list-container" id="management-list" style="flex-grow: 1;"></div>
    </div>
    <div class="column">
        <div class="panel-header yellow">LOG</div>
        <div class="list-container" id="main-log" style="flex-grow: 1;"></div>
    </div>
</main>

<div id="player-select-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-title">交代選手を選択してください</div>
        <div id="modal-player-list"></div>
        <button onclick="closeModal()" style="width:100%; margin-top:10px; padding:10px; background:var(--btn-gray); color:white; border:none; border-radius:4px; font-weight:bold;">キャンセル</button>
    </div>
</div>

<div id="restore-player-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-title">選手強制復帰（初期状態）</div>
        <div id="restore-player-list" style="max-height: 400px; overflow-y: auto;"></div>
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button id="restore-execute-btn" onclick="executePlayerRestore()" style="flex:1; padding:10px; background:var(--btn-red); color:white; border:none; border-radius:4px; font-weight:bold; opacity:0.5;" disabled>初期位置に戻す</button>
            <button onclick="closeRestoreModal()" style="flex:1; padding:10px; background:var(--btn-gray); color:white; border:none; border-radius:4px; font-weight:bold;">閉じる</button>
        </div>
    </div>
</div>

<div id="cat-setting-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-title">CATEGORY上限設定 (A2+B+C)</div>
        <div style="margin: 20px 0; display: flex; flex-direction: column; align-items: center; gap: 10px;">
            <label style="font-size:12px; color:#666;">合計人数上限</label>
            <div style="display: flex; align-items: center; gap: 20px;">
                <button class="spin-btn" onclick="adjustCatLimit(-1)" style="background:#555; color:white; border:none; width:50px; height:50px; font-size:24px; border-radius:4px; cursor:pointer;">▼</button>
                <div id="cat-limit-display" style="font-size: 36px; font-weight: bold; color: var(--btn-blue); min-width: 50px; text-align: center;">4</div>
                <button class="spin-btn" onclick="adjustCatLimit(1)" style="background:#555; color:white; border:none; width:50px; height:50px; font-size:24px; border-radius:4px; cursor:pointer;">▲</button>
            </div>
        </div>
        <div style="display:flex; gap:10px;">
            <button onclick="saveCatLimit()" style="flex:1; padding:10px; background:var(--btn-blue); color:white; border:none; border-radius:4px; font-weight:bold; cursor:pointer;">保存</button>
            <button onclick="closeCatModal()" style="flex:1; padding:10px; background:var(--btn-gray); color:white; border:none; border-radius:4px; font-weight:bold; cursor:pointer;">閉じる</button>
        </div>
    </div>
</div>

<div id="floating-menu">
    <div id="menu-drag-handle">COMMAND CENTER</div>
    <div class="menu-grid">
        <button style="background:var(--btn-blue)" onclick="menuAction('戦術交代')">戦術交代</button>
        <button style="background:var(--accent-yellow); color:black" onclick="menuAction('YC')">YC</button>
        <button style="background:#2980b9" onclick="menuAction('負傷交代')">負傷交代</button>
        <button style="background:var(--btn-red)" onclick="menuAction('RC')">RC</button>
        <button style="background:#3498db" onclick="menuAction('出血交代')">出血交代</button>
        <button style="background:#8e44ad" onclick="menuAction('OFR')">OFR</button>
        <button style="background:#2c3e50" onclick="menuAction('HIA')">HIA</button>
        <button style="background:#1abc9c" onclick="menuAction('一時退出')">一時退出</button>
        <button style="background:#5D4037" onclick="menuAction('出血HIA')">出血HIA</button>
        <button style="background:#795548" onclick="menuAction('SWAP')">SWAP</button>
        <button style="background:#555; grid-column: span 2;" onclick="closeMenu()">CLOSE</button>
    </div>
</div>

<button id="open-menu-btn" onclick="openMenu()">COMMAND MENU</button>

<script>
    let seconds = 0, timerInterval = null, selectedIds = [], playersMaster = [], initialMaster = [], managementTimers = {}, ejectedPlayers = [], managementSeconds = {};
    let isUncontested = false, categoryLimit = 4;
    let halfEndTime = null;
    let restoreTargetId = null;

    function init() {
        openMenu();
        setupDragAndDrop();
        renderLists();
    }

    function setupDragAndDrop() {
        const dropZones = [document.getElementById('field-list'), document.getElementById('bench-list')];
        dropZones.forEach(zone => {
            zone.addEventListener('dragover', (e) => { e.preventDefault(); zone.classList.add('drag-over'); });
            zone.addEventListener('dragleave', () => { zone.classList.remove('drag-over'); });
            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('drag-over');
                const file = e.dataTransfer.files[0];
                if (file && (file.name.endsWith('.xlsx') || file.name.endsWith('.xls'))) { processExcelFile(file); }
            });
        });
    }

    function openMenu() { document.getElementById('floating-menu').style.display = 'block'; }
    function closeMenu() { document.getElementById('floating-menu').style.display = 'none'; }

    function openCatModal() { 
        document.getElementById('cat-limit-display').innerText = categoryLimit; 
        document.getElementById('cat-setting-modal').style.display = 'flex'; 
    }
    function closeCatModal() { document.getElementById('cat-setting-modal').style.display = 'none'; }
    function adjustCatLimit(val) {
        let display = document.getElementById('cat-limit-display');
        let current = parseInt(display.innerText) || 0;
        display.innerText = Math.max(0, current + val);
    }
    function saveCatLimit() { 
        categoryLimit = parseInt(document.getElementById('cat-limit-display').innerText) || 0; 
        closeCatModal(); 
        updateCategoryDisplay(); 
    }

    function openRestoreModal() {
        if (initialMaster.length === 0) return alert("Excelデータが読み込まれていません。");
        const list = document.getElementById('restore-player-list');
        list.innerHTML = '';
        restoreTargetId = null;
        document.getElementById('restore-execute-btn').disabled = true;
        document.getElementById('restore-execute-btn').style.opacity = "0.5";

        initialMaster.forEach((p, idx) => {
            if (p.id === 'empty') return;
            const div = document.createElement('div');
            div.className = 'player-row';
            div.style.border = "1px solid #eee";
            div.style.marginBottom = "2px";
            div.dataset.rid = p.id;
            const posNum = idx + 1;
            const typeClass = posNum <= 15 ? 'field-circle' : 'bench-circle';
            div.innerHTML = `<div class="pos-circle ${typeClass}">${posNum}</div><div class="jersey-no">No.${p.no}</div><div class="player-name">${p.name}</div><div style="font-size:10px; opacity:0.6; text-align:center;">${p.cat}</div><div class="fr-cond">${p.fr}</div><div></div>`;
            div.onclick = () => {
                document.querySelectorAll('#restore-player-list .player-row').forEach(r => r.classList.remove('selected'));
                div.classList.add('selected');
                restoreTargetId = p.id;
                document.getElementById('restore-execute-btn').disabled = false;
                document.getElementById('restore-execute-btn').style.opacity = "1";
            };
            list.appendChild(div);
        });
        document.getElementById('restore-player-modal').style.display = 'flex';
    }

    function closeRestoreModal() { document.getElementById('restore-player-modal').style.display = 'none'; }

    function executePlayerRestore() {
        if (!restoreTargetId) return;
        const pInitial = initialMaster.find(x => x.id === restoreTargetId);
        const originalIdx = initialMaster.findIndex(x => x.id === restoreTargetId);
        if (!pInitial || originalIdx === -1) return;

        if (!confirm(`No.${pInitial.no} ${pInitial.name} を初期位置（ポジション ${originalIdx + 1}）に強制復帰させますか？\n現在この選手に関わる予約や管理データは削除されます。`)) return;

        playersMaster = playersMaster.map(p => p.id === restoreTargetId ? { id: 'empty', no: '', name: '-----', cat: '', fr: '', status: 'normal' } : p);
        ejectedPlayers = ejectedPlayers.filter(p => p.id !== restoreTargetId);

        document.querySelectorAll('.reserve-card, .mgt-card').forEach(card => {
            if (card.dataset.outId === restoreTargetId || card.dataset.inId === restoreTargetId) {
                const id = card.id.split('-')[1];
                if (managementTimers[id]) clearInterval(managementTimers[id]);
                delete managementTimers[id]; delete managementSeconds[id];
                card.remove();
            }
        });

        playersMaster[originalIdx] = JSON.parse(JSON.stringify(pInitial));
        playersMaster[originalIdx].status = 'normal';

        addLog("選手強制復帰", null, pInitial, `ポジション ${originalIdx + 1} へ復帰`);
        renderLists();
        checkFRConditions();
        closeRestoreModal();
    }

    function updateCategoryDisplay() {
        let count = 0;
        for (let i = 0; i < 15; i++) {
            const cat = (playersMaster[i].cat || '').toUpperCase();
            if (['A2','B','C','Ａ２','Ｂ','Ｃ'].includes(cat)) count++;
        }
        document.getElementById('category-display').innerText = `Category: ${count}/${categoryLimit}`;
    }

    function selectPlayer(rowElement) {
        const id = rowElement.dataset.id;
        if (!id) return;
        const p = playersMaster.find(x => x.id === id) || ejectedPlayers.find(x => x.id === id);
        if (p?.status === 'injured-out') return;

        const idx = selectedIds.indexOf(id);
        if (idx > -1) {
            rowElement.classList.remove('selected');
            selectedIds.splice(idx, 1);
        } else {
            rowElement.classList.add('selected');
            selectedIds.push(id);
        }
        updateFRHighlight();
    }

    function updateFRHighlight() {
        document.querySelectorAll('.player-row').forEach(r => r.classList.remove('fr-match'));
        if (selectedIds.length === 0) return;
        const lastSelectedId = selectedIds[selectedIds.length - 1];
        
        let lastIdx = playersMaster.findIndex(p => p.id === lastSelectedId);
        let pos = -1;
        if (lastIdx !== -1 && lastIdx < 15) {
            pos = lastIdx + 1;
        } else {
            const ejectedP = ejectedPlayers.find(p => p.id === lastSelectedId);
            if (ejectedP) pos = ejectedP.originalPos;
        }

        if (pos === -1 || pos > 15) return;

        let targetFR = "";
        if (pos === 1) targetFR = "1";
        else if (pos === 2) targetFR = "2";
        else if (pos === 3) targetFR = "3";
        else if (pos >= 4 && pos <= 8) targetFR = "FR";

        if (pos === 1 || pos === 2 || pos === 3) {
            document.querySelectorAll('.player-row').forEach(row => {
                const pid = row.dataset.id;
                const p = playersMaster.find(x => x.id === pid) || ejectedPlayers.find(x => x.id === pid);
                if (p && p.status !== 'injured-out') {
                    if (p.fr.includes(targetFR)) row.classList.add('fr-match');
                }
            });
        }
    }

    function clearSelection() { 
        document.querySelectorAll('.player-row').forEach(r => { r.classList.remove('selected'); r.classList.remove('fr-match'); });
        selectedIds = []; 
    }

    function validateCatLimit(outId, inId, type) {
        if (['YC', 'RC', 'OFR'].includes(type)) return true;
        let tempPlayers = [...playersMaster];
        
        let outIdx = tempPlayers.findIndex(p => p.id === outId);
        if (outIdx === -1) {
            const ejectedP = ejectedPlayers.find(p => p.id === outId);
            if (ejectedP) outIdx = ejectedP.originalPos - 1;
        }

        let inIdx = tempPlayers.findIndex(p => p.id === inId);
        
        if (outIdx !== -1 && outIdx < 15 && inIdx !== -1) {
            let pIn = tempPlayers[inIdx];
            tempPlayers[outIdx] = pIn;
        } else if (outIdx !== -1 && outIdx < 15) {
            tempPlayers[outIdx] = { cat: '' };
        }
        
        let count = 0;
        for (let i = 0; i < 15; i++) {
            const cat = (tempPlayers[i].cat || '').toUpperCase();
            if (['A2','B','C','Ａ２','Ｂ','Ｃ'].includes(cat)) count++;
        }
        if (count > categoryLimit) {
            return confirm(`！！！カテゴリー人数オーバー！！！\n\n現在フィールド上の対象者(A2+B+C)が${count}名になります（制限: ${categoryLimit}名）。\nこのまま実行（予約）しますか？`);
        }
        return true;
    }

    function recordHalfEnd() {
        if (halfEndTime !== null) { if (!confirm("既に前半終了処理がされています。再計算しますか？")) return; }
        const recordedSeconds = seconds;
        halfEndTime = recordedSeconds;
        const currentTimeStr = formatTimerStr(recordedSeconds);
        document.getElementById('half-end-time-display').innerText = currentTimeStr;
        addLog("前半終了", null, null, `記録時間: ${currentTimeStr}`);
        
        document.querySelectorAll('.mgt-card').forEach(card => {
            const mid = card.id.replace('mgt-', '');
            const type = card.dataset.originType;
            const startTimeStr = card.dataset.startTimeStr || "00:00";
            
            if (['YC', 'RC', 'OFR', 'HIA', '出血HIA', '出血交代', '一時退出'].includes(type)) {
                const startSec = timeStrToSeconds(startTimeStr);
                const elapsedSec = recordedSeconds - startSec;
                let initialDuration = (type === 'YC' || type === 'OFR') ? 600 : (type === 'RC' ? 1200 : (type === 'HIA' ? 720 : (type === '出血HIA' ? 1020 : 900)));
                const remaining = Math.max(0, initialDuration - elapsedSec);
                managementSeconds[mid] = remaining;
                updateMgtTimerDisplay(mid, remaining);
                card.dataset.halfAdjusted = "true";
            }
        });
        
        seconds = 2400;
        updateTimerDisplay();
        if (timerInterval) toggleTimer();
    }

    function timeStrToSeconds(str) {
        const parts = str.split(':');
        return parseInt(parts[0]) * 60 + parseInt(parts[1]);
    }

    function menuAction(type) {
        if (selectedIds.length === 0) return;
        let p1 = null, p2 = null, actionType = type;

        if (selectedIds.length >= 2) {
            p1 = playersMaster.find(x => x.id === selectedIds[0]) || ejectedPlayers.find(x => x.id === selectedIds[0]);
            p2 = playersMaster.find(x => x.id === selectedIds[1]) || ejectedPlayers.find(x => x.id === selectedIds[1]);
        } else {
            p1 = playersMaster.find(x => x.id === selectedIds[0]) || ejectedPlayers.find(x => x.id === selectedIds[0]);
            let p1Idx = playersMaster.findIndex(x => x.id === selectedIds[0]);
            if (p1Idx === -1) {
                const ep = ejectedPlayers.find(x => x.id === selectedIds[0]);
                if (ep) p1Idx = ep.originalPos - 1;
            }
            if (!['YC', 'RC', 'OFR', '負傷交代'].includes(type) && p1Idx !== -1 && p1Idx < 15) {
                if (!confirm(`${type}として予約リストに追加しますか？`)) return;
                addReservationCard(type + "（退出）", p1, null);
                clearSelection();
                return;
            }
            if (type === '負傷交代') {
                if (!confirm("負傷退場として予約リストに追加しますか？")) return;
                actionType = '負傷退場';
            }
        }

        if (!validateCatLimit(selectedIds[0], selectedIds[1] || '', actionType)) return;

        let outIdx = playersMaster.findIndex(p => p.id === (p1 ? p1.id : ''));
        if (outIdx === -1 && p1) {
            const ep = ejectedPlayers.find(p => p.id === p1.id);
            if (ep) outIdx = ep.originalPos - 1;
        }

        if (!['YC', 'RC', 'OFR'].includes(actionType)) {
            if (outIdx !== -1 && outIdx < 3) {
                const targetPos = outIdx + 1;
                const playerEnteringFront = p2;
                if (playerEnteringFront && playerEnteringFront.id !== 'empty') {
                    if (!playerEnteringFront.fr.includes(targetPos.toString())) {
                        if (!confirm(`No${playerEnteringFront.no}はFR${targetPos}の適正がありません。アンコンテスト・スクラムになりますがよろしいですか？`)) return;
                    }
                } else if (actionType === '負傷退場') {
                    if (!confirm(`フロントロー(ポジション${targetPos})が退場します。補充がないためアンコンテスト・スクラムになりますがよろしいですか？`)) return;
                }
            }
        } else {
            if (outIdx !== -1 && outIdx < 3) {
                if (!confirm(`フロントロー(ポジション${outIdx+1})がカードで退場します。アンコンテスト・スクラムになります。`)) return;
            }
        }

        if (['YC', 'RC', 'OFR'].includes(actionType)) {
            executeEjection(p1, actionType);
        } else if (actionType === '戦術交代' || actionType === 'SWAP') {
            executeExchange(p1, p2, actionType);
        } else if (['出血交代', 'HIA', '出血HIA', '一時退出'].includes(actionType)) {
            executeTemporary(p1, p2, actionType);
        } else if (actionType === '負傷退場') {
            executeInjuredOut(p1);
        }
        clearSelection();
    }

    function executeEjection(p, type) {
        let idx = playersMaster.findIndex(x => x.id === p.id);
        if (idx === -1) return;
        const outPlayer = JSON.parse(JSON.stringify(playersMaster[idx]));
        outPlayer.originalPos = idx + 1;
        ejectedPlayers.push(outPlayer);
        playersMaster[idx] = { id: 'empty', no: '', name: '-----', cat: '', fr: '', status: 'normal' };
        
        let duration = (type === 'YC' || type === 'OFR') ? 600 : 1200;
        addManagementCard(type, outPlayer, null, duration);
        addLog(type, outPlayer, null);
        renderLists();
        checkFRConditions();
    }

    function executeExchange(p1, p2, type) {
        let idx1 = playersMaster.findIndex(x => x.id === p1.id);
        let idx2 = playersMaster.findIndex(x => x.id === p2.id);
        if (idx1 === -1 || idx2 === -1) return;

        let finalP1Status = (type === '戦術交代') ? 'status-tactical-out' : 'normal';
        playersMaster[idx1] = JSON.parse(JSON.stringify(p2));
        playersMaster[idx1].status = 'normal';
        playersMaster[idx2] = JSON.parse(JSON.stringify(p1));
        playersMaster[idx2].status = finalP1Status;

        addLog(type, p1, p2);
        renderLists();
        checkFRConditions();
    }

    function executeTemporary(p1, p2, type) {
        let idx1 = playersMaster.findIndex(x => x.id === p1.id);
        let idx2 = playersMaster.findIndex(x => x.id === p2.id);
        if (idx1 === -1 || idx2 === -1) return;

        let duration = (type === 'HIA') ? 720 : (type === '出血HIA' ? 1020 : 900);
        playersMaster[idx1] = JSON.parse(JSON.stringify(p2));
        playersMaster[idx1].status = 'normal';
        playersMaster[idx2] = JSON.parse(JSON.stringify(p1));
        playersMaster[idx2].status = 'status-treating';

        addManagementCard(type, p1, p2, duration);
        addLog(type, p1, p2);
        renderLists();
        checkFRConditions();
    }

    function executeInjuredOut(p) {
        let idx = playersMaster.findIndex(x => x.id === p.id);
        if (idx === -1) return;
        playersMaster[idx].status = 'status-injured-out';
        addLog("負傷退場", p, null);
        renderLists();
        checkFRConditions();
    }

    function addManagementCard(type, pOut, pIn, duration) {
        const id = 'mgt' + Math.random().toString(36).substr(2, 9);
        managementSeconds[id] = duration;
        const card = document.createElement('div');
        card.className = 'mgt-card';
        card.id = 'mgt-' + id;
        card.dataset.originType = type;
        card.dataset.startTimeStr = formatTimerStr(seconds);
        card.dataset.outId = pOut.id;
        if (pIn) card.dataset.inId = pIn.id;

        let typeLabel = type;
        if (type === 'YC' || type === 'OFR') typeLabel = type + ' (10分退出)';
        else if (type === 'RC') typeLabel = 'RC (20分退出)';

        card.innerHTML = `
            <div class="mgt-header">
                <span class="mgt-type">${typeLabel}</span>
                <span class="mgt-timer" id="timer-${id}">${formatMgtTime(duration)}</span>
            </div>
            <div class="mgt-player-info">退出: No.${pOut.no} ${pOut.name}</div>
            ${pIn ? `<div class="mgt-player-info">代役: No.${pIn.no} ${pIn.name}</div>` : ''}
            <input type="text" class="mgt-reason-input" placeholder="理由を入力...">
            <div class="mgt-btns-row">
                <div class="mgt-status-btns">
                    <button id="btn-y-${id}" onclick="setMgtDecision('${id}', 'yellow')">出血/HIA</button>
                    <button id="btn-r-${id}" onclick="setMgtDecision('${id}', 'red')">負傷交代</button>
                    <button id="btn-n-${id}" onclick="setMgtDecision('${id}', 'normal')">戦術交代</button>
                    <button class="btn-decision-exe" onclick="executeMgtDecision('${id}')">実行</button>
                </div>
                <div class="mgt-action-btns">
                    <button class="btn-mgt-exe" onclick="executeMgtReturn('${id}')">復帰実行</button>
                    <button class="btn-mgt-del" onclick="deleteMgtCard('${id}')">削除</button>
                </div>
            </div>
        `;
        document.getElementById('management-list').prepend(card);
    }

    function updateMgtTimerDisplay(id, s) {
        const el = document.getElementById('timer-' + id);
        if (el) el.innerText = formatMgtTime(s);
    }

    function updateMgtTimers() {
        for (let id in managementSeconds) {
            if (managementSeconds[id] > 0) {
                managementSeconds[id]--;
                updateMgtTimerDisplay(id, managementSeconds[id]);
            }
        }
    }

    function formatMgtTime(s) {
        const m = Math.floor(s / 60);
        const sec = s % 60;
        return `${String(m).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
    }

    function setMgtDecision(id, decision) {
        const card = document.getElementById('mgt-' + id);
        card.dataset.decision = decision;
        document.getElementById(`btn-y-${id}`).classList.remove('active-yellow');
        document.getElementById(`btn-r-${id}`).classList.remove('active-red');
        document.getElementById(`btn-n-${id}`).classList.remove('active-normal');
        if (decision === 'yellow') document.getElementById(`btn-y-${id}`).classList.add('active-yellow');
        if (decision === 'red') document.getElementById(`btn-r-${id}`).classList.add('active-red');
        if (decision === 'normal') document.getElementById(`btn-n-${id}`).classList.add('active-normal');
    }

    function executeMgtDecision(id) {
        const card = document.getElementById('mgt-' + id);
        const decision = card.dataset.decision;
        if (!decision) return alert("ステータスを選択してください");
        const outId = card.dataset.outId;
        const pOut = playersMaster.find(p => p.id === outId);
        if (!pOut) return;

        if (decision === 'red') {
            pOut.status = 'status-injured-out';
            addLog("管理エリア確定(負傷交代)", pOut, null);
        } else if (decision === 'normal') {
            pOut.status = 'status-tactical-out';
            addLog("管理エリア確定(戦術交代)", pOut, null);
        } else if (decision === 'yellow') {
            pOut.status = 'status-treating';
            addLog("管理エリア確定(治療継続)", pOut, null);
        }
        renderLists();
    }

    function executeMgtReturn(id) {
        const card = document.getElementById('mgt-' + id);
        const outId = card.dataset.outId;
        const inId = card.dataset.inId;
        const type = card.dataset.originType;

        if (['YC', 'RC', 'OFR'].includes(type)) {
            const epIdx = ejectedPlayers.findIndex(p => p.id === outId);
            if (epIdx !== -1) {
                const p = ejectedPlayers[epIdx];
                const pos = p.originalPos - 1;
                if (playersMaster[pos].id === 'empty') {
                    playersMaster[pos] = p;
                    playersMaster[pos].status = 'normal';
                    ejectedPlayers.splice(epIdx, 1);
                    addLog(type + "復帰", p, null);
                } else {
                    return alert("元のポジションに他の選手がいるため、手動で調整してください。");
                }
            }
        } else {
            let idxOut = playersMaster.findIndex(p => p.id === outId);
            let idxIn = playersMaster.findIndex(p => p.id === inId);
            if (idxOut !== -1 && idxIn !== -1) {
                let pOut = playersMaster[idxOut];
                let pIn = playersMaster[idxIn];
                playersMaster[idxIn] = JSON.parse(JSON.stringify(pOut));
                playersMaster[idxIn].status = 'normal';
                playersMaster[idxOut] = JSON.parse(JSON.stringify(pIn));
                playersMaster[idxOut].status = 'normal';
                addLog(type + "復帰", pOut, pIn);
            }
        }
        deleteMgtCard(id);
        renderLists();
        checkFRConditions();
    }

    function deleteMgtCard(id) {
        const card = document.getElementById('mgt-' + id);
        if (card) card.remove();
        delete managementSeconds[id];
    }

    function toggleTimer() {
        const btn = document.getElementById('start-btn');
        if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
            btn.innerText = 'START';
            btn.className = 'btn-start-style';
        } else {
            timerInterval = setInterval(() => {
                seconds++;
                updateTimerDisplay();
                updateMgtTimers(); // 管理タイマーを更新
                updateReservationTimers();
            }, 1000);
            btn.innerText = 'STOP';
            btn.className = 'btn-stop-style';
        }
    }

    function updateTimerDisplay() {
        document.getElementById('timer-display').innerText = formatTimerStr(seconds);
    }

    function formatTimerStr(s) {
        const m = Math.floor(s / 60);
        const sec = s % 60;
        return `${String(m).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
    }

    function resetTimer() {
        if (!confirm("タイマーをリセットしますか？")) return;
        seconds = 0;
        if (timerInterval) toggleTimer();
        updateTimerDisplay();
    }

    function toggleTimerEdit() {
        const popup = document.getElementById('timer-edit-popup');
        const isVisible = popup.style.display === 'block';
        if (!isVisible) {
            document.getElementById('edit-min').innerText = String(Math.floor(seconds / 60)).padStart(2, '0');
            document.getElementById('edit-sec').innerText = String(seconds % 60).padStart(2, '0');
            popup.style.display = 'block';
        } else {
            popup.style.display = 'none';
        }
    }

    function adjustTime(val) {
        seconds = Math.max(0, seconds + val);
        document.getElementById('edit-min').innerText = String(Math.floor(seconds / 60)).padStart(2, '0');
        document.getElementById('edit-sec').innerText = String(seconds % 60).padStart(2, '0');
        updateTimerDisplay();
    }

    function handleExcel(event) {
        const file = event.target.files[0];
        if (file) processExcelFile(file);
    }

    function processExcelFile(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const wb = XLSX.read(data, { type: 'array' });
            const json = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], { header: 1 });
            document.getElementById('team-name-display').innerText = json[0] ? json[0][2] : "TEAM";
            playersMaster = []; initialMaster = [];
            for (let j = 2; j < 25; j++) {
                const r = json[j] || [];
                let frs = [];
                if (r[3] === "TRUE" || r[3] === true) frs.push(1);
                if (r[4] === "TRUE" || r[4] === true) frs.push(2);
                if (r[5] === "TRUE" || r[5] === true) frs.push(3);
                const pObj = {
                    id: 'p' + Math.random().toString(36).substr(2, 9),
                    no: r[0] || '',
                    name: r[1] || '-----',
                    cat: r[2] || '',
                    fr: frs.length ? `${frs.join(' ')}` : '',
                    status: 'normal'
                };
                playersMaster.push(pObj);
                initialMaster.push(JSON.parse(JSON.stringify(pObj)));
            }
            renderLists();
            checkFRConditions();
        };
        reader.readAsArrayBuffer(file);
    }

    function renderLists() {
        const field = document.getElementById('field-list');
        const bench = document.getElementById('bench-list');
        const ejected = document.getElementById('ejected-list');
        field.innerHTML = ''; bench.innerHTML = ''; ejected.innerHTML = '';

        playersMaster.forEach((p, i) => {
            const row = createPlayerRow(p, i + 1);
            if (i < 15) field.appendChild(row);
            else bench.appendChild(row);
        });

        ejectedPlayers.forEach(p => {
            const row = createPlayerRow(p, p.originalPos, true);
            ejected.appendChild(row);
        });
        updateCategoryDisplay();
    }

    function createPlayerRow(p, posNum, isEjected = false) {
        const div = document.createElement('div');
        div.className = 'player-row ' + (p.status || 'normal');
        if (p.id === 'empty') div.classList.add('empty-row');
        if (selectedIds.includes(p.id)) div.classList.add('selected');
        div.dataset.id = p.id;

        let circleClass = posNum <= 15 ? 'field-circle' : 'bench-circle';
        if (isEjected) circleClass = 'red-circle';

        div.innerHTML = `
            <div class="pos-circle ${circleClass}">${posNum}</div>
            <div class="jersey-no">No.${p.no}</div>
            <div class="player-name">${p.name}</div>
            <div style="font-size:10px; opacity:0.6; text-align:center;">${p.cat}</div>
            <div class="fr-cond">${p.fr}</div>
            <div>${isEjected ? `<button class="btn-ejected-del" onclick="deleteEjected('${p.id}')">削除</button>` : ''}</div>
        `;
        div.onclick = () => selectPlayer(div);
        return div;
    }

    function deleteEjected(id) {
        if (!confirm("この選手の退場データを削除しますか？")) return;
        ejectedPlayers = ejectedPlayers.filter(p => p.id !== id);
        renderLists();
    }

    function checkFRConditions() {
        let fr1 = 0, fr2 = 0, fr3 = 0;
        for (let i = 0; i < 15; i++) {
            const p = playersMaster[i];
            if (p.fr.includes('1')) fr1++;
            if (p.fr.includes('2')) fr2++;
            if (p.fr.includes('3')) fr3++;
        }
        isUncontested = (fr1 === 0 || fr2 === 0 || fr3 === 0);
        document.getElementById('uncontested-banner').style.display = isUncontested ? 'block' : 'none';
    }

    function addLog(type, pOut, pIn, extra = "") {
        const log = document.getElementById('main-log');
        const plog = document.getElementById('penalty-log');
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        if (type === 'YC') entry.classList.add('yc-bg');
        if (type === 'RC') entry.classList.add('rc-bg');

        const time = formatTimerStr(seconds);
        let text = `[${time}] ${type}: `;
        if (pOut && pOut.id !== 'empty') text += `OUT No.${pOut.no} ${pOut.name} `;
        if (pIn && pIn.id !== 'empty') text += `IN No.${pIn.no} ${pIn.name} `;
        if (extra) text += `(${extra})`;

        entry.innerHTML = `<span>${text}</span><button class="btn-log-del" onclick="this.parentElement.remove()">×</button>`;
        log.prepend(entry);

        if (['YC', 'RC', 'OFR'].includes(type)) {
            plog.prepend(entry.cloneNode(true));
        }
    }

    function addReservationCard(type, pOut, pIn) {
        const id = 'res' + Math.random().toString(36).substr(2, 9);
        const card = document.createElement('div');
        card.className = 'reserve-card';
        card.id = 'res-' + id;
        card.dataset.outId = pOut ? pOut.id : '';
        card.dataset.inId = pIn ? pIn.id : '';
        card.dataset.type = type;

        card.innerHTML = `
            <div class="reserve-info">
                <strong>${type}</strong><br>
                ${pOut ? `OUT: No.${pOut.no} ${pOut.name}` : ''}
                ${pIn ? `<br>IN: No.${pIn.no} ${pIn.name}` : ''}
            </div>
            <div class="reserve-btns">
                <button class="btn-reserve-exe" onclick="executeReservation('${id}')">実行</button>
                <button class="btn-reserve-del" onclick="this.closest('.reserve-card').remove()">削除</button>
            </div>
        `;
        document.getElementById('reservation-list').appendChild(card);
    }

    function executeReservation(id) {
        const card = document.getElementById('res-' + id);
        const type = card.dataset.type;
        const pOut = playersMaster.find(p => p.id === card.dataset.outId) || ejectedPlayers.find(p => p.id === card.dataset.outId);
        const pIn = playersMaster.find(p => p.id === card.dataset.inId);

        if (type.includes('戦術交代')) executeExchange(pOut, pIn, '戦術交代');
        else if (type.includes('SWAP')) executeExchange(pOut, pIn, 'SWAP');
        else if (type.includes('出血交代')) executeTemporary(pOut, pIn, '出血交代');
        else if (type.includes('HIA')) executeTemporary(pOut, pIn, 'HIA');
        else if (type.includes('出血HIA')) executeTemporary(pOut, pIn, '出血HIA');
        else if (type.includes('一時退出')) executeTemporary(pOut, pIn, '一時退出');

        card.remove();
    }

    function updateReservationTimers() {
        // 必要に応じて予約リストのタイマー処理を追加可能
    }

    const menu = document.getElementById("floating-menu"), handle = document.getElementById("menu-drag-handle");
    let isDrag = false, ox, oy;
    handle.onmousedown = (e) => { isDrag = true; ox = e.clientX - menu.offsetLeft; oy = e.clientY - menu.offsetTop; };
    document.onmousemove = (e) => { if (isDrag) { menu.style.left = (e.clientX - ox) + "px"; menu.style.top = (e.clientY - oy) + "px"; menu.style.margin = "0"; } };
    document.onmouseup = () => isDrag = false;

    // タッチ操作対応
    handle.addEventListener('touchstart', function (e) {
        isDrag = true;
        const touch = e.touches[0];
        ox = touch.clientX - menu.offsetLeft;
        oy = touch.clientY - menu.offsetTop;
    }, { passive: false });
    document.addEventListener('touchmove', function (e) {
        if (!isDrag) return;
        const touch = e.touches[0];
        menu.style.left = (touch.clientX - ox) + 'px';
        menu.style.top = (touch.clientY - oy) + 'px';
        menu.style.margin = "0";
    }, { passive: false });
    document.addEventListener('touchend', function () { isDrag = false; });

</script>
</body>
</html>
